<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>musings about silly things</title>
    <link>http://heiber.im/</link>
    <description>Recent content on musings about silly things</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <managingEditor>hello@heiber.im (Moritz Heiber)</managingEditor>
    <webMaster>hello@heiber.im (Moritz Heiber)</webMaster>
    <lastBuildDate>Tue, 23 Feb 2016 18:24:05 +0100</lastBuildDate>
    <atom:link href="http://heiber.im/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Creating a good, secure Docker base image</title>
      <link>http://heiber.im/post/creating-a-solid-docker-base-image/</link>
      <pubDate>Tue, 23 Feb 2016 18:24:05 +0100</pubDate>
      <author>hello@heiber.im (Moritz Heiber)</author>
      <guid>http://heiber.im/post/creating-a-solid-docker-base-image/</guid>
      <description>

&lt;p&gt;&lt;em&gt;Last updated: &lt;a href=&#34;#updates:901618bebcbe06bc74bd8d987e29f817&#34;&gt;2016-02-25&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;tl;dr&lt;/strong&gt;: Build small, efficient images, use &lt;a href=&#34;https://www.alpinelinux.org/&#34;&gt;Alpine Linux&lt;/a&gt; as your foundation, build from there, add glibc if necessary, remove static/generated files and documentation, never run more than one process per container and use verified, trustworthy sources.&lt;/p&gt;

&lt;h1 id=&#34;the-premise:901618bebcbe06bc74bd8d987e29f817&#34;&gt;The premise&lt;/h1&gt;

&lt;p&gt;When I first started using Docker, everyone kept raving about how easy and intuitive it was to use, how incredibly well it handled itself and how much time everyone was saving because of it. Once I gave it a try I discovered that not only was almost any image bloated beyond recognition, used very insecure practices (no package signing, &lt;code&gt;curl | sh&lt;/code&gt; installing, blind trust in upstream hub images etc.) but also none of them adhered to the concept Docker was intended for originally: &lt;em&gt;Isolated, single-process, easily distributable, lean images&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Docker images, explicitly, are not designed to replace complex virtual machine setups, fully integrated with logging, monitoring, alerting and several resources running side-by-side. Instead, Docker encourages composition by following the paradigm of the kernel environment abstraction though &lt;a href=&#34;https://en.wikipedia.org/wiki/Cgroups&#34;&gt;cgroups&lt;/a&gt; and &lt;a href=&#34;https://en.wikipedia.org/wiki/Cgroups#Namespace_isolation&#34;&gt;namespaces&lt;/a&gt;. It&amp;rsquo;s as if you were trying to say&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Give me the very same bare-bones environment the &lt;code&gt;init&lt;/code&gt; process gets on my machine once the kernel has finished initializing.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;ll take over from there&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;That is also why the process you&amp;rsquo;re specifying in your &lt;code&gt;Dockerfile&lt;/code&gt;&amp;rsquo;s &lt;code&gt;CMD&lt;/code&gt; instruction is started with &lt;code&gt;PID 1&lt;/code&gt;. It&amp;rsquo;s a close resemblance of what defines Unix as a whole.&lt;/p&gt;

&lt;p&gt;Look at your process list right now, using &lt;code&gt;top&lt;/code&gt; or &lt;code&gt;ps&lt;/code&gt; for example, and you will find the process &lt;code&gt;init&lt;/code&gt; claiming that very same &lt;code&gt;PID&lt;/code&gt;. It&amp;rsquo;s the core of every Unix operating system, the mother of all processes. Once you have internalized this concept, that every single process on Unix is a child of &lt;code&gt;init&lt;/code&gt;, you will understand the environment a Docker container is supposed to live in: No-frills, bare kernel exposure. The minimum for any process to live on.&lt;/p&gt;

&lt;p&gt;That&amp;rsquo;s our starting point&lt;/p&gt;

&lt;h1 id=&#34;how-to-get-started:901618bebcbe06bc74bd8d987e29f817&#34;&gt;How to get started&lt;/h1&gt;

&lt;p&gt;Now, today&amp;rsquo;s applications are complex software systems. Most of them require a lot of libraries to work correctly; there are schedulers, actors, compilers and a hundreds other helpers involved in designing and implementing modern software applications. Their architecture, usually, is hermetically shielded from us, through layers and layers of abstractions and interfaces, and while that can also be said for containers in a sense, at least from a system architecture perspective we need to think a little simpler than we did before with whole virtual environments.&lt;/p&gt;

&lt;h2 id=&#34;taking-java-as-an-example:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Taking Java as an example&lt;/h2&gt;

&lt;p&gt;To start things off, and to build the most basic container you can run your application on, think of your application by itself. What does it actually need to run?&lt;/p&gt;

&lt;p&gt;Chances are, if you&amp;rsquo;re running a Java application, it&amp;rsquo;ll probably need a Java runtime environment. If you&amp;rsquo;re running a Rails application it will need a runtime Ruby interpreter. The same logic applies to Python applications. Go and other compiled languages are a little different in this regard, but I will come that later.&lt;/p&gt;

&lt;p&gt;Advancing with the Java example, the next step to think about is: What does a JRE require to run? Since it&amp;rsquo;s the single most vital component to getting your application to run, the next logical step would be to figure out what the JRE needs to run your code.&lt;/p&gt;

&lt;p&gt;As it turns out, not that much really. The Java Virtual Machine (JVM) is meant to function as an operating system abstraction layer; to run code independently of its host environment. Thus you are pretty much set once you have a JRE (Java Runtime Environment) ready to go.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;(In reality, operating system independence cannot be taken for granted. There are a ton of operating system specific APIs and proprietary system extensions. But for the sake of this example, let&amp;rsquo;s focus on the easier alternative.)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;I will be presenting this example case based on the assumption we are talking about a Linux x86_64, since, although Java theoretically runs independent of OS architectures, Docker, the container engine described in this example, does not. &lt;a href=&#34;https://docs.docker.com/machine/overview/#why-should-i-use-it&#34;&gt;It runs on Linux, and Linux only&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;On Linux, the JVM mainly hooks into an existing C library for making most of its calls to the underlying OS, and therefore your machine. Oracle&amp;rsquo;s official JRE, which unfortunately most people use to this day, does this through interfacing with &lt;strong&gt;libc&lt;/strong&gt;, otherwise also know as &lt;strong&gt;glibc&lt;/strong&gt;. This means, for being able to actually run a Java program of any sort you need to be able to run its virtual machine, which in turn requires glibc. Apart from that you probably want some sort of shell to manage your environment, and a way of interfacing with the outside world, i.e. networking and resource abstraction.&lt;/p&gt;

&lt;p&gt;To sum up our requirements to run an example Java application:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;A JRE, in your example, we&amp;rsquo;ll take the Oracle JRE&lt;/li&gt;
&lt;li&gt;glibc, for running the JRE&lt;/li&gt;
&lt;li&gt;A shell, for the sake of familiarity we will take the popular bash shell&lt;/li&gt;
&lt;li&gt;A bare bones environment to give us awareness for networking, memory management, filesystem support and other important abstractions like (ttys, input/output handling etc.)&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;enter-alpine-linux:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Enter Alpine Linux&lt;/h1&gt;

&lt;p&gt;&lt;a href=&#34;https://www.alpinelinux.org/&#34;&gt;Alpine Linux&lt;/a&gt; has been gaining a lot of support as a distribution recently, mainly because it &lt;a href=&#34;https://pkgs.alpinelinux.org/packages&#34;&gt;packs quite a punch in terms of selection of pre-build, signed and trusted packages&lt;/a&gt; while only clocking a very impressive 2MB (!) in size when attached to a Docker container. To put this into perspective, while writing this post, the latest base images (already stripped down to their very code functionality) for other distributions maintain the following sizing:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ubuntu:latest&lt;/code&gt;: 66MB (already fairly slim compared to, e.g. earlier images which sometimes carried around 600MB+ with them)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;debian:latest&lt;/code&gt;: 55MB (same as above, quite alright considering they started with 200MB+)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;arch:latest&lt;/code&gt;: 145MB (I took the &lt;a href=&#34;https://hub.docker.com/r/dock0/arch/&#34;&gt;dock0/arch image&lt;/a&gt; as there are no &amp;ldquo;official&amp;rdquo;, Docker Inc maintained images for Arch Linux)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;busybox:latest&lt;/code&gt;: 676KB (Yes, that&amp;rsquo;s &lt;strong&gt;Kilobytes&lt;/strong&gt;; I&amp;rsquo;ll come to that in a second)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;alpine:latest&lt;/code&gt;: 2MB (In words, TWO megabytes. And that&amp;rsquo;s an actual Linux system with a package manager!)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I won&amp;rsquo;t go into detail of what Alpine Linux actually is and why it exists. &lt;a href=&#34;https://www.alpinelinux.org/about/&#34;&gt;They are doing a pretty good job on their own&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;busybox-as-the-smallest-contender:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Busybox as the smallest contender?&lt;/h2&gt;

&lt;p&gt;As you can see from the comparison, the only one beating Alpine Linux to the punch in terms of sizing is the Busybox image. 676KB are a testament as to why Busybox is used in pretty much all embedded systems requiring any kind of shell environment these days. It&amp;rsquo;s used in routers, switches, credit card terminals (seriously) and, someday, &lt;a href=&#34;http://www.bbc.com/future/story/20150216-be-afraid-of-the-smart-toaster&#34;&gt;probably your toaster&lt;/a&gt;. It&amp;rsquo;s as bare bones as bare bones can be, while still providing a sufficient, well maintained shell system interface.&lt;/p&gt;

&lt;p&gt;And that&amp;rsquo;s also why you will want to choose Alpine Linux over Busybox if you want a little more wiggle room in terms of flexibility.&lt;/p&gt;

&lt;p&gt;There are a lot of articles on the web explaining &lt;a href=&#34;http://odino.org/minimal-docker-run-your-nodejs-app-in-25mb-of-an-image/&#34;&gt;why people chose Alpine Linux over &amp;ldquo;just&amp;rdquo; Busybox&lt;/a&gt; (Alpine Linux is based upon Busybox). But to sum them up in an instant:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Versatile, open, actively maintained package repository&lt;/strong&gt;: Alpine Linux uses the &lt;code&gt;apk&lt;/code&gt; package manager, which is baked right into the Docker image that&amp;rsquo;s shipped through official channels. With &lt;code&gt;Busybox&lt;/code&gt; you&amp;rsquo;d need to add a package manager, such as &lt;code&gt;opkg&lt;/code&gt;, and even then you still need a reliable source for package information, which hardly exist. The &lt;a href=&#34;https://openwrt.org/&#34;&gt;OpenWRT project&lt;/a&gt; maintains some repositories, but they are working for a very specific angle, and Alpine Linux ships a larger subset of the unilaterally available packages you would usually find available from any of the other major distributions out there. To sum it up: If you still compile software like NodeJS or Ruby to use them in your container you can just run &lt;code&gt;apk add nodejs ruby&lt;/code&gt; in the future and be done in a matter of seconds.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Size does matter. But not when you&amp;rsquo;re arguing functionality, versatility and accessibility in the realms of 1 &lt;sup&gt;1&lt;/sup&gt;&amp;frasl;&lt;sub&gt;2&lt;/sub&gt; megabytes&lt;/strong&gt;: The added benefits Alpine Linux gives you over Busybox are immense, so much so, that adding just a fraction in size for your later image does not really matter in this case. To put this into perspective: Pulling in &lt;code&gt;bash&lt;/code&gt;, as a package on Alpine Linux, adds a whooping 5MB to your Docker image. That&amp;rsquo;s two Alpine containers, and then some!&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Broad, open support&lt;/strong&gt;: Docker Inc. has hired &lt;a href=&#34;https://twitter.com/n_copa&#34;&gt;the creator of Alpine Linux&lt;/a&gt; to work on it in Docker&amp;rsquo;s interest. All official images, maintained by Docker Inc., &lt;a href=&#34;https://www.brianchristner.io/docker-is-moving-to-alpine-linux/&#34;&gt;will be moving (or have been moved already) to Alpine Linux&lt;/a&gt;. This means first class citizen vendor support for the very foundation of your images. There is nothing better and more convincing than this if you&amp;rsquo;re starting to build your own containers.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;building-a-java-enabled-base-image:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Building a Java enabled base image&lt;/h1&gt;

&lt;p&gt;As I just explained, Alpine Linux is a good choice for the foundation of your own image, specifically the &lt;code&gt;FROM&lt;/code&gt; instruction in your &lt;code&gt;Dockerfile&lt;/code&gt;. Hence, we will be using it to build our own lean and efficient Docker image. Let&amp;rsquo;s get started!&lt;/p&gt;

&lt;h2 id=&#34;the-seams-alpine-bash:901618bebcbe06bc74bd8d987e29f817&#34;&gt;The seams: Alpine + bash&lt;/h2&gt;

&lt;p&gt;Every &lt;code&gt;Dockerfile&lt;/code&gt; starts with an instruction which specifies its parent container. Usually, that&amp;rsquo;s an image you are inheriting from; in our case it&amp;rsquo;s the &lt;code&gt;alpine:latest&lt;/code&gt; image:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;FROM alpine:latest
MAINTAINER Moritz Heiber &amp;lt;hello@heiber.im&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We are also specifying who&amp;rsquo;s responsible for the image. This information is vital to the Docker ecosystem and also for uploading the image to the &lt;a href=&#34;https://hub.docker.com/&#34;&gt;Docker Hub&lt;/a&gt; at some later point in time.&lt;/p&gt;

&lt;p&gt;That&amp;rsquo;s it, now you have a canvas to work with. Let&amp;rsquo;s install our chosen shell, &lt;code&gt;bash&lt;/code&gt;, and run our container for the first time. Add the following instructions to your &lt;code&gt;Dockerfile&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;RUN apk add --no-cache --update-cache bash
CMD [&amp;quot;/bin/bash&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The resulting &lt;code&gt;Dockerfile&lt;/code&gt; should look like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;FROM alpine:latest
MAINTAINER Moritz Heiber &amp;lt;hello@heiber.im&amp;gt; # You want to add your own name here

RUN apk add --no-cache --update-cache bash
CMD [&amp;quot;/bin/bash&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Great! Let&amp;rsquo;s build this container:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker build -t my-java-base-image .
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM alpine:latest
 ---&amp;gt; 2314ad3eeb90
Step 2 : MAINTAINER Moritz Heiber &amp;lt;hello@heiber.im&amp;gt;
 ---&amp;gt; Running in 63433312d77e
 ---&amp;gt; bfe94713797a
Removing intermediate container 63433312d77e
Step 3 : RUN apk --no-cache --update-cache add bash
 ---&amp;gt; Running in 12ae43605260
fetch http://dl-4.alpinelinux.org/alpine/v3.3/main/x86_64/APKINDEX.tar.gz
fetch http://dl-4.alpinelinux.org/alpine/v3.3/main/x86_64/APKINDEX.tar.gz
fetch http://dl-4.alpinelinux.org/alpine/v3.3/community/x86_64/APKINDEX.tar.gz
fetch http://dl-4.alpinelinux.org/alpine/v3.3/community/x86_64/APKINDEX.tar.gz
(1/5) Installing ncurses-terminfo-base (6.0-r6)
(2/5) Installing ncurses-terminfo (6.0-r6)
(3/5) Installing ncurses-libs (6.0-r6)
(4/5) Installing readline (6.3.008-r4)
(5/5) Installing bash (4.3.42-r3)
Executing bash-4.3.42-r3.post-install
Executing busybox-1.24.1-r7.trigger
OK: 13 MiB in 16 packages
 ---&amp;gt; 2ea4fbc1c950
Removing intermediate container 12ae43605260
Step 4 : CMD /bin/bash
 ---&amp;gt; Running in d2291684b797
 ---&amp;gt; ecc443d68f27
Removing intermediate container d2291684b797
Successfully built ecc443d68f27
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And run it:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker run --rm -ti my-java-base-image
bash-4.3#
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Success! We have an image running &lt;code&gt;bash&lt;/code&gt; on top of Alpine Linux.&lt;/p&gt;

&lt;p&gt;Now for the rest of the required parts.&lt;/p&gt;

&lt;h2 id=&#34;glibc-and-friends:901618bebcbe06bc74bd8d987e29f817&#34;&gt;glibc and friends&lt;/h2&gt;

&lt;p&gt;As mentioned before, Oracle&amp;rsquo;s JRE needs a working copy of glibc to run properly. Alpine Linux doesn&amp;rsquo;t use glibc though, it uses a much smaller alternatives named &lt;a href=&#34;http://www.musl-libc.org/&#34;&gt;musl libc&lt;/a&gt;. If you have ever worked with glibc you know how it has grown over the years (like any large software product) to include provisions for pretty much any software problem you could possibly come up with in C. Obviously, that versatility comes with trade-offs, one of them being size. A regular glibc, compiled to work on Alpine Linux, clocks in at roughly 5MB, and the resulting packages based on that package would carry an overhead as well. The alternative, musl-libc comes as a single-binary, 897KB image, and supports all the necessary parts to run modern binaries on Linux architectures. It&amp;rsquo;s a trade-off you&amp;rsquo;ll gladly make.&lt;/p&gt;

&lt;p&gt;Unless you have to use glibc to run proprietary code.&lt;/p&gt;

&lt;p&gt;With Oracle&amp;rsquo;s JRE, there is no way around adding glibc to our small image. Luckily, &lt;a href=&#34;https://github.com/andyshinn&#34;&gt;Andy Shinn&lt;/a&gt; has done all of the work for us already, preparing pre-compiled, signed glibc images for Alpine Linux. They are in the &lt;a href=&#34;https://github.com/andyshinn/alpine-pkg-glibc&#34;&gt;alpine-pkg-glibc&lt;/a&gt; repository on GitHub, with the most recent release being &lt;a href=&#34;https://github.com/andyshinn/alpine-pkg-glibc/releases/tag/2.23-r1&#34;&gt;2.23-r1&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s add these packages by changing our &lt;code&gt;Dockerfile&lt;/code&gt; in the following way:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-docker&#34;&gt;ENV GLIBC_PKG_VERSION=2.23-r1

RUN apk add --no-cache --update-cache curl ca-certificates bash &amp;amp;&amp;amp; \
  curl -Lo /etc/apk/keys/andyshinn.rsa.pub &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/andyshinn.rsa.pub&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-bin-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-bin-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-i18n-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-i18n-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  apk add glibc-${GLIBC_PKG_VERSION}.apk glibc-bin-${GLIBC_PKG_VERSION}.apk glibc-i18n-${GLIBC_PKG_VERSION}.apk &amp;amp;&amp;amp; \
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Our &lt;code&gt;Dockerfile&lt;/code&gt; now looks like this:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;FROM alpine:latest
MAINTAINER Moritz Heiber &amp;lt;hello@heiber.im&amp;gt;

ENV GLIBC_PKG_VERSION=2.23-r1

RUN apk add --no-cache --update-cache curl ca-certificates bash &amp;amp;&amp;amp; \
  curl -Lo /etc/apk/keys/andyshinn.rsa.pub &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/andyshinn.rsa.pub&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-bin-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-bin-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-i18n-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-i18n-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  apk add glibc-${GLIBC_PKG_VERSION}.apk glibc-bin-${GLIBC_PKG_VERSION}.apk glibc-i18n-${GLIBC_PKG_VERSION}.apk

CMD [&amp;quot;/bin/bash&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Let&amp;rsquo;s walk through these instructions one by one:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;ENV GLIBC_PKG_VERSION=2.23-r1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We want to stay on the current version of glibc released on GitHub. While you could just exchange URLs each and every time a new release comes up, putting the current version into a variable within the &lt;code&gt;Dockerfile&lt;/code&gt; makes switching versions as easy as editing a single line.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;RUN apk add --update-cache curl ca-certificates bash &amp;amp;&amp;amp; \
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This &lt;code&gt;RUN&lt;/code&gt; instruction will use the &lt;code&gt;apk&lt;/code&gt; command to install the packages we need in order to fetch resources from somewhere else. Obviously, I chose &lt;code&gt;curl&lt;/code&gt;, and I also installed the &lt;code&gt;ca-certificates&lt;/code&gt; package to make sure we aren&amp;rsquo;t going to run into trouble when accessing TLS enabled websites. Lastly, &lt;code&gt;bash&lt;/code&gt; at the end we already had in our last iteration of our &lt;code&gt;Dockerfile&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;  curl -Lo /etc/apk/keys/andyshinn.rsa.pub &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/andyshinn.rsa.pub&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-bin-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-bin-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-i18n-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-i18n-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;These commands are appended to the &lt;code&gt;RUN&lt;/code&gt; instruction we just discussed. They are &lt;strong&gt;downloading the author&amp;rsquo;s public key and the release packages&lt;/strong&gt; for glibc directly from GitHub.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note: To this day I haven&amp;rsquo;t found a single &lt;code&gt;Dockerfile&lt;/code&gt; which actually verifies the content of these signed packages. I&amp;rsquo;ve decided to rather &lt;a href=&#34;https://github.com/andyshinn/alpine-pkg-glibc/issues/2&#34;&gt;get the packages fixed&lt;/a&gt; and verify their signatures during the build process before releasing this blog post&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;  apk add glibc-${GLIBC_PKG_VERSION}.apk glibc-bin-${GLIBC_PKG_VERSION}.apk glibc-i18n-${GLIBC_PKG_VERSION}.apk
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Once we&amp;rsquo;ve downloaded all the packages we can go ahead and install them all using this one line. Their signatures will be verified since we added the author&amp;rsquo;s public key earlier.&lt;/p&gt;

&lt;p&gt;All right! We now have a full-fledged environment ready to run (almost) all package requiring glibc!&lt;/p&gt;

&lt;h2 id=&#34;the-java-runtime-environment:901618bebcbe06bc74bd8d987e29f817&#34;&gt;The Java Runtime Environment&lt;/h2&gt;

&lt;p&gt;Traditionally, Oracle doesn&amp;rsquo;t take all that kindly to people downloading their software some a repository. However, people have found a way of doing so regardless. You can install their JRE by adding the following command(s) to your &lt;code&gt;Dockerfile&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;ENV JAVA_VERSION_MAJOR=8 \
    JAVA_VERSION_MINOR=73 \
    JAVA_VERSION_BUILD=02 \
    JAVA_PACKAGE=server-jre

WORKDIR /tmp

RUN curl -jksSLH &amp;quot;Cookie: oraclelicense=accept-securebackup-cookie&amp;quot; \
  &amp;quot;http://download.oracle.com/otn-pub/java/jdk/${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-b${JAVA_VERSION_BUILD}/${JAVA_PACKAGE}-${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-linux-x64.tar.gz&amp;quot; | gunzip -c - | tar -xf - &amp;amp;&amp;amp; \
  apk del curl ca-certificates &amp;amp;&amp;amp; \
  mv jdk1.${JAVA_VERSION_MAJOR}.0_${JAVA_VERSION_MINOR}/jre /jre &amp;amp;&amp;amp; \
  rm /jre/bin/jjs &amp;amp;&amp;amp; \
  rm /jre/bin/keytool &amp;amp;&amp;amp; \
  rm /jre/bin/orbd &amp;amp;&amp;amp; \
  rm /jre/bin/pack200 &amp;amp;&amp;amp; \
  rm /jre/bin/policytool &amp;amp;&amp;amp; \
  rm /jre/bin/rmid &amp;amp;&amp;amp; \
  rm /jre/bin/rmiregistry &amp;amp;&amp;amp; \
  rm /jre/bin/servertool &amp;amp;&amp;amp; \
  rm /jre/bin/tnameserv &amp;amp;&amp;amp; \
  rm /jre/bin/unpack200 &amp;amp;&amp;amp; \
  rm /jre/lib/ext/nashorn.jar &amp;amp;&amp;amp; \
  rm /jre/lib/jfr.jar &amp;amp;&amp;amp; \
  rm -rf /jre/lib/jfr &amp;amp;&amp;amp; \
  rm -rf /jre/lib/oblique-fonts &amp;amp;&amp;amp; \
  rm -rf /tmp/* /var/cache/apk/* &amp;amp;&amp;amp; \
  echo &#39;hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4&#39; &amp;gt;&amp;gt; /etc/nsswitch.conf

ENV JAVA_HOME /jre
ENV PATH ${PATH}:${JAVA_HOME}/bin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Woah! There is so much going on with these commands, what&amp;rsquo;s happening?!&lt;/p&gt;

&lt;p&gt;All right, all right, let&amp;rsquo;s step through them one by one before we take a look at the &lt;code&gt;Dockerfile&lt;/code&gt; as a whole:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;ENV JAVA_VERSION_MAJOR=8 \
    JAVA_VERSION_MINOR=73 \
    JAVA_VERSION_BUILD=02 \
    JAVA_PACKAGE=server-jre

WORKDIR /tmp
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This one&amp;rsquo;s pretty simple. It defines the software version we want to obtain from Oracle&amp;rsquo;s servers. While writing this document, the versions mentioned above where the most recent. That might have changed since. You can get to the latest available version by &lt;a href=&#34;http://www.java.com/en/download/linux_manual.jsp&#34;&gt;looking at Oracle&amp;rsquo;s website&lt;/a&gt;.
It also specifies the instruction &lt;code&gt;WORKDIR&lt;/code&gt; which basically just changes the working directory to &lt;code&gt;/tmp&lt;/code&gt; in this instance. We need a temporary directory to work from, &lt;code&gt;/tmp&lt;/code&gt; seems an appropriate location as any.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;RUN curl -jksSLH &amp;quot;Cookie: oraclelicense=accept-securebackup-cookie&amp;quot; \
  &amp;quot;http://download.oracle.com/otn-pub/java/jdk/${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-b${JAVA_VERSION_BUILD}/${JAVA_PACKAGE}-${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-linux-x64.tar.gz&amp;quot; | gunzip -c - | tar -xf - &amp;amp;&amp;amp; \
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This one&amp;rsquo;s a tad bit more complicated. It uses &lt;code&gt;curl&lt;/code&gt; to pass a special header (&lt;code&gt;&amp;quot;Cookie: oraclelicense=accept-securebackup-cookie&amp;quot;&lt;/code&gt;) to Oracle&amp;rsquo;s download servers before obtaining the actual software package. It&amp;rsquo;s required since otherwise you&amp;rsquo;d be getting a negative response.
It then proceeds to construct a valid URL from the variables we passed into the &lt;code&gt;Dockerfile&lt;/code&gt; in our first step, while piping the result directly into &lt;code&gt;gunzip&lt;/code&gt; and &lt;code&gt;tar&lt;/code&gt;.
In other words: It doesn&amp;rsquo;t actually save the downloaded tarball anywhere, but rather extracts the contained software package directly onto our filesystem. Quite nifty!&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;apk del curl ca-certificates &amp;amp;&amp;amp; \
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;At this point in time both of these packages have done their deed and are no longer required. They were &amp;ldquo;build dependencies&amp;rdquo;, needed to set up the container, but not to actually run the application, eventually. It&amp;rsquo;s good practice to remove them right now, to conserve space.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;  rm /jre/bin/jjs &amp;amp;&amp;amp; \
  rm /jre/bin/keytool &amp;amp;&amp;amp; \
  rm /jre/bin/orbd &amp;amp;&amp;amp; \
  rm /jre/bin/pack200 &amp;amp;&amp;amp; \
  rm /jre/bin/policytool &amp;amp;&amp;amp; \
  rm /jre/bin/rmid &amp;amp;&amp;amp; \
  rm /jre/bin/rmiregistry &amp;amp;&amp;amp; \
  rm /jre/bin/servertool &amp;amp;&amp;amp; \
  rm /jre/bin/tnameserv &amp;amp;&amp;amp; \
  rm /jre/bin/unpack200 &amp;amp;&amp;amp; \
  rm /jre/lib/ext/nashorn.jar &amp;amp;&amp;amp; \
  rm /jre/lib/jfr.jar &amp;amp;&amp;amp; \
  rm -rf /jre/lib/jfr &amp;amp;&amp;amp; \
  rm -rf /jre/lib/oblique-fonts &amp;amp;&amp;amp; \
  rm -rf /tmp/* /var/cache/apk/* &amp;amp;&amp;amp; \
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The JRE comes with a lot of tools you probably will never need to run your actual application. Again, to save on space we are going to remove most of them.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note: This might differ for your environment. Maybe you need a couple of them. It depends on what you need to run your application.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The last line, finally, removes all of our temporary files and also the packaging caches built by &lt;code&gt;apk&lt;/code&gt;. Within the immutable container we do not need either of them anymore.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;echo &#39;hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4&#39; &amp;gt;&amp;gt; /etc/nsswitch.conf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Last but not least, we modify the &lt;code&gt;nsswitch.conf&lt;/code&gt; in order to make sure we are able to properly resolve networking entities. This isn&amp;rsquo;t used by Alpine Linux directly, but by glibc (and therefore, Java), and thus we still need to apply this rather crude hack of re-arranging the order hosts are resolved from.&lt;/p&gt;

&lt;p&gt;In the end, your &lt;code&gt;Dockerfile&lt;/code&gt; should now look a little something like this:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;FROM alpine:latest
MAINTAINER Moritz Heiber &amp;lt;hello@heiber.im&amp;gt;

ENV JAVA_VERSION_MAJOR=8 \
    JAVA_VERSION_MINOR=73 \
    JAVA_VERSION_BUILD=02 \
    JAVA_PACKAGE=server-jre \
    GLIBC_PKG_VERSION=2.23-r1 \
    LANG=en_US.UTF8

WORKDIR /tmp

RUN apk add --no-cache --update-cache curl ca-certificates bash &amp;amp;&amp;amp; \
  curl -Lo /etc/apk/keys/andyshinn.rsa.pub &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/andyshinn.rsa.pub&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-bin-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-bin-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  curl -Lo glibc-i18n-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-i18n-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp; \
  apk add glibc-${GLIBC_PKG_VERSION}.apk glibc-bin-${GLIBC_PKG_VERSION}.apk glibc-i18n-${GLIBC_PKG_VERSION}.apk &amp;amp;&amp;amp; \
  curl -jksSLH &amp;quot;Cookie: oraclelicense=accept-securebackup-cookie&amp;quot; \
  &amp;quot;http://download.oracle.com/otn-pub/java/jdk/${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-b${JAVA_VERSION_BUILD}/${JAVA_PACKAGE}-${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-linux-x64.tar.gz&amp;quot; | gunzip -c - | tar -xf - &amp;amp;&amp;amp; \
  apk del curl ca-certificates &amp;amp;&amp;amp; \
  mv jdk1.${JAVA_VERSION_MAJOR}.0_${JAVA_VERSION_MINOR}/jre /jre &amp;amp;&amp;amp; \
  rm /jre/bin/jjs &amp;amp;&amp;amp; \
  rm /jre/bin/keytool &amp;amp;&amp;amp; \
  rm /jre/bin/orbd &amp;amp;&amp;amp; \
  rm /jre/bin/pack200 &amp;amp;&amp;amp; \
  rm /jre/bin/policytool &amp;amp;&amp;amp; \
  rm /jre/bin/rmid &amp;amp;&amp;amp; \
  rm /jre/bin/rmiregistry &amp;amp;&amp;amp; \
  rm /jre/bin/servertool &amp;amp;&amp;amp; \
  rm /jre/bin/tnameserv &amp;amp;&amp;amp; \
  rm /jre/bin/unpack200 &amp;amp;&amp;amp; \
  rm /jre/lib/ext/nashorn.jar &amp;amp;&amp;amp; \
  rm /jre/lib/jfr.jar &amp;amp;&amp;amp; \
  rm -rf /jre/lib/jfr &amp;amp;&amp;amp; \
  rm -rf /jre/lib/oblique-fonts &amp;amp;&amp;amp; \
  rm -rf /tmp/* /var/cache/apk/* &amp;amp;&amp;amp; \
  echo &#39;hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4&#39; &amp;gt;&amp;gt; /etc/nsswitch.conf

ENV JAVA_HOME=/jre
ENV PATH=${PATH}:${JAVA_HOME}/bin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Notice how I have merged the two &lt;code&gt;ENV&lt;/code&gt; and &lt;code&gt;RUN&lt;/code&gt; instructions. This is mainly because it&amp;rsquo;s better to use a smaller amount of intermediary layers, especially since this is supposed to be a container everybody uses as a building block. If you want to find out more about Docker, containers, images and layers I recommend reading &lt;a href=&#34;https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/&#34;&gt;the official documentation on what layers are and how images are using them to their benefit&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;As a rule of thumb: More layers if you want more flexibility, less layers if you want to save on size and complexity. It depends on your preferences.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;I also added another variable at the top:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;ENV LANG=en_US.UTF-8
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is the ensure we are running a clean environment with a defined language. Some application might expect to find these values already set, some might be setting them yourself. Obviously, your preference in language might also differ. &lt;a href=&#34;https://www.gnu.org/software/gettext/manual/html_node/Locale-Environment-Variables.html&#34;&gt;You can adjust the LANG parameter to your liking&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Last but not least, the variables &lt;code&gt;JAVA_HOME&lt;/code&gt; and &lt;code&gt;PATH&lt;/code&gt; are adjusted according to the location of the JRE we just installed. &lt;code&gt;JAVA_HOME&lt;/code&gt; and &lt;code&gt;PATH&lt;/code&gt; have to be declared in two separate statements in this case because &lt;code&gt;PATH&lt;/code&gt; directly refers to &lt;code&gt;JAVA_HOME&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&#34;where-did-the-cmd-instruction-go:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Where did the CMD instruction go?&lt;/h2&gt;

&lt;p&gt;I mentioned before, we are building an image meant to be used as a foundation for other services. As such, it doesn&amp;rsquo;t need to carry a &lt;code&gt;CMD&lt;/code&gt; instruction, as it will never be run &amp;ldquo;verbatim&amp;rdquo;, but rather with a service attached to it which will occupy the &lt;code&gt;CMD&lt;/code&gt; instruction.&lt;/p&gt;

&lt;p&gt;You can still run commands inside the container by either using &lt;code&gt;docker run&lt;/code&gt; or &lt;code&gt;docker exec&lt;/code&gt;. For running a shell in your newly created container, use the following command:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker run --rm -ti my-java-base-image /bin/bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The last statement at the end of the &lt;code&gt;docker&lt;/code&gt; command will be executed instead of the container&amp;rsquo;s &lt;code&gt;CMD&lt;/code&gt; instruction.&lt;/p&gt;

&lt;h1 id=&#34;building-the-final-image:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Building the final image&lt;/h1&gt;

&lt;p&gt;Finally, we&amp;rsquo;ve reached a point where we can build our image:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker build -t my-java-base-image .
Sending build context to Docker daemon 60.42 kB
Step 1 : FROM alpine:latest
 ---&amp;gt; 2314ad3eeb90
Step 2 : MAINTAINER Moritz Heiber &amp;lt;hello@heiber.im&amp;gt;
 ---&amp;gt; Using cache
 ---&amp;gt; 93cc2bc0bd60
Step 3 : ENV JAVA_VERSION_MAJOR 8 JAVA_VERSION_MINOR 73 JAVA_VERSION_BUILD 02 JAVA_PACKAGE server-jre GLIBC_PKG_VERSION 2.23-r1 LANG en_US.UTF8
 ---&amp;gt; Running in 3f0ffeaeca78
 ---&amp;gt; 1dcfd34b0f1a
Removing intermediate container 3f0ffeaeca78
Step 4 : WORKDIR /tmp
 ---&amp;gt; Running in 5c81aa8921e0
 ---&amp;gt; 9904a9a1a0af
Removing intermediate container 5c81aa8921e0
Step 5 : RUN apk add --no-cache --update-cache curl ca-certificates bash &amp;amp;&amp;amp;   curl -Lo /etc/apk/keys/andyshinn.rsa.pub &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/andyshinn.rsa.pub&amp;quot; &amp;amp;&amp;amp;   curl -Lo glibc-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp;   curl -Lo glibc-bin-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-bin-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp;   curl -Lo glibc-i18n-${GLIBC_PKG_VERSION}.apk &amp;quot;https://github.com/andyshinn/alpine-pkg-glibc/releases/download/${GLIBC_PKG_VERSION}/glibc-i18n-${GLIBC_PKG_VERSION}.apk&amp;quot; &amp;amp;&amp;amp;   apk add glibc-${GLIBC_PKG_VERSION}.apk glibc-bin-${GLIBC_PKG_VERSION}.apk glibc-i18n-${GLIBC_PKG_VERSION}.apk &amp;amp;&amp;amp;   curl -jksSLH &amp;quot;Cookie: oraclelicense=accept-securebackup-cookie&amp;quot;   &amp;quot;http://download.oracle.com/otn-pub/java/jdk/${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-b${JAVA_VERSION_BUILD}/${JAVA_PACKAGE}-${JAVA_VERSION_MAJOR}u${JAVA_VERSION_MINOR}-linux-x64.tar.gz&amp;quot; | gunzip -c - | tar -xf - &amp;amp;&amp;amp;   apk del curl ca-certificates &amp;amp;&amp;amp;   mv jdk1.${JAVA_VERSION_MAJOR}.0_${JAVA_VERSION_MINOR}/jre /jre &amp;amp;&amp;amp;   rm /jre/bin/jjs &amp;amp;&amp;amp;   rm /jre/bin/keytool &amp;amp;&amp;amp;   rm /jre/bin/orbd &amp;amp;&amp;amp;   rm /jre/bin/pack200 &amp;amp;&amp;amp;   rm /jre/bin/policytool &amp;amp;&amp;amp;   rm /jre/bin/rmid &amp;amp;&amp;amp;   rm /jre/bin/rmiregistry &amp;amp;&amp;amp;   rm /jre/bin/servertool &amp;amp;&amp;amp;   rm /jre/bin/tnameserv &amp;amp;&amp;amp;   rm /jre/bin/unpack200 &amp;amp;&amp;amp;   rm /jre/lib/ext/nashorn.jar &amp;amp;&amp;amp;   rm /jre/lib/jfr.jar &amp;amp;&amp;amp;   rm -rf /jre/lib/jfr &amp;amp;&amp;amp;   rm -rf /jre/lib/oblique-fonts &amp;amp;&amp;amp;   rm -rf /tmp/* /var/cache/apk/* &amp;amp;&amp;amp;   echo &#39;hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4&#39; &amp;gt;&amp;gt; /etc/nsswitch.conf
 ---&amp;gt; Running in ab3222998627
fetch http://dl-4.alpinelinux.org/alpine/v3.3/main/x86_64/APKINDEX.tar.gz
fetch http://dl-4.alpinelinux.org/alpine/v3.3/main/x86_64/APKINDEX.tar.gz
fetch http://dl-4.alpinelinux.org/alpine/v3.3/community/x86_64/APKINDEX.tar.gz
fetch http://dl-4.alpinelinux.org/alpine/v3.3/community/x86_64/APKINDEX.tar.gz
(1/9) Installing ncurses-terminfo-base (6.0-r6)
(2/9) Installing ncurses-terminfo (6.0-r6)
(3/9) Installing ncurses-libs (6.0-r6)
(4/9) Installing readline (6.3.008-r4)
(5/9) Installing bash (4.3.42-r3)
Executing bash-4.3.42-r3.post-install
(6/9) Installing openssl (1.0.2f-r0)
(7/9) Installing ca-certificates (20160104-r2)
(8/9) Installing libssh2 (1.6.0-r0)
(9/9) Installing curl (7.47.0-r0)
Executing busybox-1.24.1-r7.trigger
Executing ca-certificates-20160104-r2.trigger
OK: 15 MiB in 20 packages
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   594    0   594    0     0   1135      0 --:--:-- --:--:-- --:--:--  1200
100   451  100   451    0     0    417      0  0:00:01  0:00:01 --:--:--   417
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   609    0   609    0     0   1246      0 --:--:-- --:--:-- --:--:--  1247
100 2874k  100 2874k    0     0   777k      0  0:00:03  0:00:03 --:--:-- 1211k
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   613    0   613    0     0   1286      0 --:--:-- --:--:-- --:--:--  1293
100 1710k  100 1710k    0     0   515k      0  0:00:03  0:00:03 --:--:--  649k
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   614    0   614    0     0   1162      0 --:--:-- --:--:-- --:--:--  1178
100 7154k  100 7154k    0     0  1314k      0  0:00:05  0:00:05 --:--:-- 1736k
(1/4) Installing glibc (2.23-r1)
(2/4) Installing libgcc (5.3.0-r0)
(3/4) Installing glibc-bin (2.23-r1)
(4/4) Installing glibc-i18n (2.23-r1)
Executing glibc-bin-2.23-r1.trigger
OK: 31 MiB in 24 packages
(1/4) Purging curl (7.47.0-r0)
(2/4) Purging ca-certificates (20160104-r2)
(3/4) Purging openssl (1.0.2f-r0)
(4/4) Purging libssh2 (1.6.0-r0)
Executing busybox-1.24.1-r7.trigger
Executing glibc-bin-2.23-r1.trigger
OK: 29 MiB in 20 packages
 ---&amp;gt; 51992d8f231c
Removing intermediate container ab3222998627
Step 6 : ENV JAVA_HOME /jre
 ---&amp;gt; Running in 0a98b36a6e37
 ---&amp;gt; 5af4d87e3790
Removing intermediate container 0a98b36a6e37
Step 7 : ENV PATH ${PATH}:${JAVA_HOME}/bin
 ---&amp;gt; Running in 54d0dfb04f98
 ---&amp;gt; 493399ac9ca6
Removing intermediate container 54d0dfb04f98
Successfully built 493399ac9ca6
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Woohoo! It finished successfully. To make sure it actually did what we asked for, let&amp;rsquo;s try running &lt;code&gt;java&lt;/code&gt; inside the container, shall we?&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker run --rm -ti my-java-base-image java -version
java version &amp;quot;1.8.0_73&amp;quot;
Java(TM) SE Runtime Environment (build 1.8.0_73-b02)
Java HotSpot(TM) 64-Bit Server VM (build 25.73-b02, mixed mode)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Brilliant! That&amp;rsquo;s exactly what we wanted. Now we have a full-fledged base image with Oracle&amp;rsquo;s JRE ready to be used by another application. In the future, the only thing you need to do is to use your own base image as a &lt;code&gt;FROM&lt;/code&gt; instruction in your application&amp;rsquo;s &lt;code&gt;Dockerfile&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Docker&#34;&gt;FROM my-java-base-image

[...]
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;how-large-is-the-resulting-image:901618bebcbe06bc74bd8d987e29f817&#34;&gt;How large is the resulting image?&lt;/h2&gt;

&lt;p&gt;Let&amp;rsquo;s find out:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker images | grep my-java-base-image | awk &#39;{print $7,$8}&#39;
130.4 MB
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That is quite large to be honest. Our original image clocked in at a mere 9MB.&lt;/p&gt;

&lt;p&gt;But that&amp;rsquo;s Java for you, I guess ;)&lt;/p&gt;

&lt;h1 id=&#34;conclusion:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;We have built a solid, small and efficient Docker container image together which is capable of running pretty much any Java application you throw at it. Of course, there are edge cases for which you will have to adapt the configuration, but the general ideas behind it, starting small, growing carefully, using secure sources for building your image, are transcending these probable changes.&lt;/p&gt;

&lt;p&gt;Once you realize that a Docker container shouldn&amp;rsquo;t be anything else but a bare bones, single-process container for your application you can start focussing on just the essentials without having to care about any of cruft that&amp;rsquo;s usually pulled in alongside regular setup routines.&lt;/p&gt;

&lt;h2 id=&#34;a-few-simple-guidelines:901618bebcbe06bc74bd8d987e29f817&#34;&gt;A few simple guidelines&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Run one process per container&lt;/strong&gt;: If you need multiple processes (logging, monitoring, databases etc.) build a composition of containers, utilizing tools like &lt;a href=&#34;https://docs.docker.com/compose/overview/&#34;&gt;docker-compose&lt;/a&gt;. An example of this paradigm is the &lt;a href=&#34;https://github.com/moritzheiber/piwigo-docker&#34;&gt;Piwigo docker-compose configuration&lt;/a&gt; I built a short while ago.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Start (very) small&lt;/strong&gt;: You don&amp;rsquo;t need a whole Debian or Ubuntu image to get started, especially if you&amp;rsquo;re using languages that compile to static binaries (i.e. C/C++/Golang). Almost every time a small Alpine Linux image + your compiled application &amp;ldquo;just works&amp;rdquo;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Be efficient with your layering&lt;/strong&gt;: Adding more layers onto an image allows for easier tagging/debugging, but it will bloat your container ecosystem over time. Try to manage your container layers as you manage your container size.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Security is vital, be sure which images you pull from&lt;/strong&gt;: If you are not, you&amp;rsquo;re essentially using unsigned, unverified images. &lt;a href=&#34;https://docs.docker.com/engine/security/trust/content_trust/&#34;&gt;Docker has started working on this issue&lt;/a&gt; but there still is a long way to go. The images we used, as well as the glibc package and the JRE, are either obtained from official sources (Docker distributed the Alpine Linux image; Oracle&amp;rsquo;s JRE is downloaded directly from their servers) or signed/verified throughout the installation process (glibc package).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Now, go ahead and build small, lean and efficient containers!&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&#34;acknowledgements:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Acknowledgements&lt;/h2&gt;

&lt;p&gt;This all wouldn&amp;rsquo;t have gotten written if it weren&amp;rsquo;t for the fantastic work of &lt;a href=&#34;https://github.com/andyshinn&#34;&gt;Andy Shinn&lt;/a&gt;. Thanks Andy!&lt;/p&gt;

&lt;h2 id=&#34;feedback:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Feedback&lt;/h2&gt;

&lt;p&gt;I hope you enjoyed this article. Should you have comments, questions or suggestions (or even constructive criticism ) let me know on &lt;a href=&#34;https://twitter.com/moritzheiber&#34;&gt;Twitter&lt;/a&gt; or &lt;a href=&#34;mailto:hello@heiber.im&#34;&gt;write me an email&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;updates:901618bebcbe06bc74bd8d987e29f817&#34;&gt;Updates&lt;/h2&gt;

&lt;h3 id=&#34;2016-02-25:901618bebcbe06bc74bd8d987e29f817&#34;&gt;2016-02-25&lt;/h3&gt;

&lt;p&gt;I received this helpful comment on Twitter yesterday:&lt;/p&gt;

&lt;blockquote class=&#34;twitter-tweet&#34;&gt;&lt;p lang=&#34;en&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/docker&#34;&gt;@docker&lt;/a&gt; &lt;a href=&#34;https://twitter.com/moritzheiber&#34;&gt;@moritzheiber&lt;/a&gt; great post and i have one addition: multiple variables in 1 ENV would have saved you 3 layers:&lt;br&gt;&lt;br&gt;ENV A=1 \&lt;br&gt;B=2 \&lt;br&gt;C=3&lt;/p&gt;&amp;mdash; Jan (@KekSfabrik_EU) &lt;a href=&#34;https://twitter.com/KekSfabrik_EU/status/702533088505683968&#34;&gt;February 24, 2016&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;

&lt;p&gt;I therefore went ahead and adjusted the &lt;code&gt;Dockerfile&lt;/code&gt;, the references and the explanations accordingly. &lt;strong&gt;Thank you, Jan!&lt;/strong&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>My thoughts on the Fitbit One</title>
      <link>http://heiber.im/post/my_thoughts_on_the_fitbit_one/</link>
      <pubDate>Thu, 11 Jun 2015 07:55:54 +0200</pubDate>
      <author>hello@heiber.im (Moritz Heiber)</author>
      <guid>http://heiber.im/post/my_thoughts_on_the_fitbit_one/</guid>
      <description>

&lt;p&gt;Like pretty much anyone interested in technology I was curious from the very beginning what body or fitness trackers can provide of value to our every day lives at this point in time. The ability to accurately judge your level of fitness and what to do about staying healthy is something I&amp;rsquo;d truly appreciate. I&amp;rsquo;ve been struggling with my body weight since I was a small child and still struggling with staying healthy, positive and depression free to this very date.&lt;/p&gt;

&lt;p&gt;The next chapter recounts my experience using the Fitbit One for three weeks. And while I also purchased a Jawbone UP2, I won&amp;rsquo;t give an account of its performance here since it didn&amp;rsquo;t do any better than the One, in fact, it performed considerably worse in most categories.&lt;/p&gt;

&lt;h1 id=&#34;fitbit-one:6d68888f96fe63e8931dde6f6aa7577b&#34;&gt;Fitbit One&lt;/h1&gt;

&lt;p&gt;I mainly purchased the &lt;a href=&#34;http://www.fitbit.com/one&#34;&gt;Fitbit One&lt;/a&gt; to help me with the seemingly never-ending quest of losing/keeping weight, staying in good health and also to maybe improve my sleeping habits. I turned to the One for a couple of of reasons:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;I sweat&lt;/strong&gt;. A lot at times. Especially when I&amp;rsquo;m at practice/working out. It&amp;rsquo;s just something I&amp;rsquo;ve come to terms with. It used to be worse, back when I still had 20+ pounds more to carry around with me, but it&amp;rsquo;s still noticeably different from other people working out barely breaking a sweat. The One is a simple tracker you fix to your clothing, it&amp;rsquo;s sweat resistant, and thus ideal for me to work out with. A bracelet would probably be itching after half a day or two without taking it off in between (which is not what I&amp;rsquo;m after) with all the sweat and grease accumulating under its band. Furthermore, pretty much any of these straps are said to cause allergic skin reactions at some point time (which my family, myself to a lesser extend, are prone to).&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;I like the prospect of being woken up lightly&lt;/strong&gt;. And without disturbing the sleep of my significant other. The discrete vibrations the One is giving off is good enough for getting me up in the morning. I was torn at first, still keeping my iPhone&amp;rsquo;s alarm set for a comfortable time, but I&amp;rsquo;ve done away with it. The One&amp;rsquo;s good enough.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;http://www.tomsguide.com/us/heart-rate-monitor,review-2885.html&#34;&gt;Heartbeat enabled wrist trackers are a sham&lt;/a&gt;&lt;/strong&gt;. There, I&amp;rsquo;ve set it. Yes, and even your beloved Apple Watch is barely accurate at judging your pulse/activity. It still takes professional equipment (read: a proper heart rate sensor strapped to your chest) to measure your workouts accurately. I&amp;rsquo;m not paying extra for technology that barely works as advertised.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For keeping track of my meals, I also connected it to &lt;a href=&#34;https://www.myfitnesspal.com/&#34;&gt;MyFitnessPal&lt;/a&gt; to let the One know about my calorie intake and my weight.&lt;/p&gt;

&lt;p&gt;I then started wearing it tucked away in my trousers&amp;rsquo; pockets.&lt;/p&gt;

&lt;h2 id=&#34;what-i-liked-about-it:6d68888f96fe63e8931dde6f6aa7577b&#34;&gt;What I liked about it&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Accuracy&lt;/strong&gt;: I never had the impression that the One wasn&amp;rsquo;t up to the task of measuring what it&amp;rsquo;s meant to be measuring accurately. That is, steps and floors climbed. Anything else it needs to extrapolate from the limited data it&amp;rsquo;s getting.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Size, weight&lt;/strong&gt;: For me, these tracker will have to be hardly noticeable to wear them comfortably. The One is tiny, you can basically stick anywhere on your body (except for your limbs) and it&amp;rsquo;ll work reliably.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Battery life&lt;/strong&gt;: While some appreciate getting through the day on a single charge while using their mobile phone I&amp;rsquo;m continuously baffled by lack of juice most wireless appliances carry around these days. The One comes with at least 5 - 7 days of battery power, well enough to get me through a week. And it&amp;rsquo;s charger is micro USB, just like your phone&amp;rsquo;s, which makes it a good travel companion.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Software/dashboard/app&lt;/strong&gt;: Fitbit did a great job at their online software functionality. Their website has a dashboard with your most important data that you may adjust and rearrange to your liking. Consequently, the mobile app (tested on iOS) you&amp;rsquo;re using on a day-to-day basis is just as beautiful and easy to use. I hardly felt at home so quickly with any other connected app before. It&amp;rsquo;s also modestly good at visualizing your daily/weekly goals, although I sort of missed reminders or encouragement throughout the day.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Silent wake-up calls&lt;/strong&gt;: The One is able to wake you silently at a time of your choosing. It doesn&amp;rsquo;t do any &amp;ldquo;smart&amp;rdquo; alarms (i.e. wake you up according to your sleep cycle) but I found the feature to work sufficiently well and didn&amp;rsquo;t miss any of the features other manufactures are tooting for their product line.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;what-i-didn-t-like:6d68888f96fe63e8931dde6f6aa7577b&#34;&gt;What I didn&amp;rsquo;t like&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Activity tracking&lt;/strong&gt;: So, as I mentioned, the one&amp;rsquo;s good at tracking your steps and the amount of floors traversed each day. It really sucks at tracking pretty much anything else though. Riding your bike? Out of luck, the One doesn&amp;rsquo;t know about it. Going for a run? Better make sure you tell the One that you&amp;rsquo;re going for a run. Going to sleep? Push the right button and &lt;strong&gt;put it in a sleeve you have to wear throughout the whole night&lt;/strong&gt;. Just the sleeve itself is infuriating at times, since it clearly is exposed to a lot of tear and wear after just a couple of nights.
But the sleep tracking is also lacking in granularity severely, and it doesn&amp;rsquo;t figure out when you&amp;rsquo;re going to sleep and have woken up automatically, &lt;strong&gt;despite setting the alarm&lt;/strong&gt;. The fact that you constantly have to think about &amp;ldquo;Do I need to tell it what I&amp;rsquo;m doing right now?&amp;rdquo; is really distracting and I just couldn&amp;rsquo;t figure at times why the One wasn&amp;rsquo;t able to gather enough data to guess what I&amp;rsquo;m doing at the specific moment in time. A serious flaw to me.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Water resistence&lt;/strong&gt;: &amp;ldquo;Splash proof&amp;rdquo; just doesn&amp;rsquo;t cut it for something that is supposed to be tracking all my activities throughout the day. Plus, the design of the One could&amp;rsquo;ve allowed for a tighter, more resistant casing. Why Fitbit didn&amp;rsquo;t go for that obvious advantage is beyond me.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Calorie burn&lt;/strong&gt;: This is largely based on the steps you take and the floors you climb throughout the day. Therefore, it&amp;rsquo;s horrendously off in precisely the situations you actually want it to be accurate: When you exercise, i.e. actually trying to change your life for the better. While running would be accounted for semi-accurately, others like lifting weights, boxing or swimming would be out of the question. Either the One&amp;rsquo;s count is awfully off or you&amp;rsquo;re not able to track the activity at all.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Product cycle&lt;/strong&gt;: The One&amp;rsquo;s been on the market for almost 3 years. It&amp;rsquo;s save to say Fitbit isn&amp;rsquo;t going to invest a lot of time into improving a product that&amp;rsquo;s 3 years old. In a market that changing as rapidly as the tracker landscape that&amp;rsquo;s not really an option and I reckon the One is going to (or as some might argue, already does) suffer from the same level of negligence as its sister product, the Aria smart scale, does.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;what-i-ended-up-doing:6d68888f96fe63e8931dde6f6aa7577b&#34;&gt;What I ended up doing&lt;/h2&gt;

&lt;p&gt;Well, I sent it back.&lt;/p&gt;

&lt;p&gt;All in all I couldn&amp;rsquo;t shake the feeling of using inadequate technology for a task it never was meant to cover. I&amp;rsquo;d love to get technology that helps me live a healthier life, but I&amp;rsquo;m afraid the current standard isn&amp;rsquo;t quite there yet. It&amp;rsquo;s probably going to take at least another year until it&amp;rsquo;s viable enough.&lt;/p&gt;

&lt;p&gt;Also, all of these trackers do not come in cheap, the One is available from 95€, it&amp;rsquo;s fiercest competitor, the Jawbone UP2, costs upwards of 120€. That&amp;rsquo;s not exactly pocket change, at least not for me. Which puts a heavier emphasize on my last argument.&lt;/p&gt;

&lt;p&gt;It was worth a try, but for now I&amp;rsquo;m as well off without a fitness tracker than I am with one.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Switching to Hugo</title>
      <link>http://heiber.im/post/switching-to-hugo/</link>
      <pubDate>Sun, 10 May 2015 20:12:10 +0200</pubDate>
      <author>hello@heiber.im (Moritz Heiber)</author>
      <guid>http://heiber.im/post/switching-to-hugo/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://gohugo.io&#34;&gt;Hugo&lt;/a&gt; is a static site generator written in &lt;a href=&#34;http://golang.org&#34;&gt;Go&lt;/a&gt;. It&amp;rsquo;s incredibly fast and flexible, has a unique template engine, and writing themes is really easy, should the slew of available themes not be to your liking. I decided to use it because it lets me get rid of all the dependencies &lt;a href=&#34;http://jekyllrb.com/&#34;&gt;Jekyll&lt;/a&gt; came with, it had a comprehensive preview mechanism (&lt;code&gt;hugo server&lt;/code&gt;) and it allowed for a very narrow deployment pipeline to &lt;a href=&#34;http://pages.github.com&#34;&gt;GitHub Pages&lt;/a&gt;, where this site is hosted at. Coincidentally, this is also why it doesn&amp;rsquo;t offer TLS supports.&lt;/p&gt;

&lt;p&gt;So without further ado, here are some instructions on how to get a Hugo site of your own, hosted on GitHub, for free!&lt;/p&gt;

&lt;h2 id=&#34;installing-hugo:536c0d2c3e7d958cd4c405a28a07ba8a&#34;&gt;Installing Hugo&lt;/h2&gt;

&lt;p&gt;Since Hugo is written in Go downloading and installing it can be as easy as pulling the individual binary and shoving it into the right place in your &lt;code&gt;$PATH&lt;/code&gt;. Just go to their &lt;a href=&#34;https://github.com/spf13/hugo/releases&#34;&gt;release website&lt;/a&gt; and take your pick. I used the &lt;code&gt;_amd64.deb&lt;/code&gt; since I&amp;rsquo;m running Ubuntu:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ wget https://github.com/spf13/hugo/releases/download/v0.13/hugo_0.13_amd64.deb
$ dpkg -i hugo_0.13_amd64.deb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This will install &lt;code&gt;hugo&lt;/code&gt; to &lt;code&gt;/usr/bin&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ dpkg -L hugo
/usr/bin/hugo
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Obviously, you can also pull down the sources (via git or by downloading the zip file) and compile your own binary. &lt;a href=&#34;http://gohugo.io/overview/installing#installing-from-source&#34;&gt;There are detailed instructions on Hugo&amp;rsquo;s website&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;creating-your-new-hugo-site:536c0d2c3e7d958cd4c405a28a07ba8a&#34;&gt;Creating your new Hugo site&lt;/h2&gt;

&lt;p&gt;To set up the Hugo scaffolding for your new site all you need to run is:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ hugo new site &amp;lt;path&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now your directory in &lt;code&gt;&amp;lt;path&amp;gt;&lt;/code&gt; should look something like this:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ ls
archetypes  config.toml  content  data  layouts  static
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Hugo uses &lt;code&gt;toml&lt;/code&gt; as its configuration syntax by default. However, you can also use &lt;code&gt;yaml&lt;/code&gt; or &lt;code&gt;json&lt;/code&gt; if you prefer either of those. The few directories carry a certain significance since taxonomy in Hugo is based on its directory structure:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://gohugo.io/content/archetypes/&#34;&gt;archetypes&lt;/a&gt;: This contains the default definitions for new content. You can add things like &lt;code&gt;tags&lt;/code&gt; or &lt;code&gt;categories&lt;/code&gt; here.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://gohugo.io/content/organization/&#34;&gt;content&lt;/a&gt;: Here is where all your content goes. This means regular pages or, nested in directories, posts, categories etc.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://gohugo.io/extras/datafiles/&#34;&gt;data&lt;/a&gt;: You can store a poor man&amp;rsquo;s database in here and reference it right in your templates and pages.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://gohugo.io/templates/overview/&#34;&gt;layouts&lt;/a&gt;: Relevant site layouts can be found in here. Usually, those would be provided by themes you&amp;rsquo;re using.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;static&lt;/code&gt;: Any content you don&amp;rsquo;t need to have touched by Hugo but want to use on your website goes in here.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now, the &lt;code&gt;config.toml&lt;/code&gt; is where you main site configuration is stored. For my site it looks like this:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-toml&#34;&gt;# Your website URL
baseurl = &amp;quot;http://heiber.im&amp;quot;  
# The language you&#39;re using on it
languageCode = &amp;quot;en-us&amp;quot;  
# The main title of your website
title = &amp;quot;musings about silly things&amp;quot;  
# This should be here if you plan on using GitHub Pages
canonifyurls = true
# This is the editor Hugo calls upon when you run &amp;quot;hugo new post/something.md&amp;quot;
editor = &amp;quot;vim&amp;quot; 
# [...]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You can take a look at the current file &lt;a href=&#34;https://github.com/moritzheiber/huge-blog-website/blob/master/config.toml&#34;&gt;on GitHub&lt;/a&gt;. There are also a lot of theme dependent variables in there, which you can use pretty much anywhere in your layouts, theme definitions and content. &lt;a href=&#34;http://gohugo.io/templates/variables/&#34;&gt;There&amp;rsquo;s a whole section on template variables in the docs&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;grab-a-theme-you-like:536c0d2c3e7d958cd4c405a28a07ba8a&#34;&gt;Grab a theme you like&lt;/h2&gt;

&lt;p&gt;There is a &lt;a href=&#34;https://github.com/spf13/hugoThemes&#34;&gt;separate repository containing a lot of diverse and different themes&lt;/a&gt;. As of this moment there isn&amp;rsquo;t a comprehensive overview of the available themes accessible yet, however, there&amp;rsquo;s &lt;a href=&#34;https://github.com/spf13/hugoThemes/issues/35&#34;&gt;a ticket in GitHub which you can follow&lt;/a&gt; about finally getting a site up and running for exactly that purpose.&lt;/p&gt;

&lt;p&gt;There are two ways of still giving them a try/taking a peek:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Each theme should contain a screenshot of it&amp;rsquo;s whole glory in the &lt;code&gt;images/&lt;/code&gt; directory. If it doesn&amp;rsquo;t consider filing an issue.&lt;/li&gt;
&lt;li&gt;You can use the instructions mentioned in the &lt;code&gt;README.md&lt;/code&gt; to clone all of the available themes in the repository and then run &lt;code&gt;hugo server -t &amp;lt;theme-name&amp;gt;&lt;/code&gt; in order to try out each theme with your newly created blog&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;start-creating-content:536c0d2c3e7d958cd4c405a28a07ba8a&#34;&gt;Start creating content!&lt;/h2&gt;

&lt;p&gt;Now just run &lt;code&gt;hugo new post/new-first-post.md&lt;/code&gt; and have at it! If you want to see your changes appear incrementally you can run &lt;code&gt;hugo -w&lt;/code&gt; (&lt;code&gt;-w&lt;/code&gt; for &amp;ldquo;watch for changes&amp;rdquo;) in another window and navigate to &lt;a href=&#34;http://localhost:1313&#34;&gt;http://localhost:1313&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Especially with complicated markdown formatting this is a huge timesaver.&lt;/p&gt;

&lt;h2 id=&#34;push-it-to-the-web:536c0d2c3e7d958cd4c405a28a07ba8a&#34;&gt;Push it to the web&lt;/h2&gt;

&lt;p&gt;After you&amp;rsquo;re done just run &lt;code&gt;hugo&lt;/code&gt; once in the blog&amp;rsquo;s directory. Mind your theme choice; you can use &lt;code&gt;-t &amp;lt;theme-name&amp;gt;&lt;/code&gt; if you haven&amp;rsquo;t added it to the configuration.&lt;/p&gt;

&lt;p&gt;Your statically created site is now ready for consumption in &lt;code&gt;public/&lt;/code&gt;. You can upload it anywhere you so desire. I personally host my website on GitHub Pages. There&amp;rsquo;s &lt;a href=&#34;http://gohugo.io/tutorials/github-pages-blog/&#34;&gt;a chapter on it in the Hugo docs&lt;/a&gt;. Just make sure to use the right method of branching/pushing, i.e. personal websites do not use a &lt;code&gt;gh-pages&lt;/code&gt; branch but rather &lt;code&gt;master&lt;/code&gt; directly.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;ve created a &lt;code&gt;deploy.sh&lt;/code&gt; script which alleviates some of pain in the repetitive tasks you need to repeat in order to get your site onto GitHub Pages:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#!/bin/bash

GIT_URL=&amp;quot;git@github.com:moritzheiber/moritzheiber.github.io.git&amp;quot;
GIT_BRANCH=&amp;quot;master&amp;quot;

echo -e &amp;quot;\033[0;32mDeploying updates to GitHub...\033[0m&amp;quot;

push_git () {
  msg=&amp;quot;Rebuilding site `date`&amp;quot;
  if [ $# -eq 1 ] ; then 
    msg=&amp;quot;$1&amp;quot;
  fi
  
  # Commit changes.
  git commit -m &amp;quot;$msg&amp;quot;

  # Push source and build repos.
  git push origin master
  git subtree push --prefix public ${GIT_URL} ${GIT_BRANCH}
}

# Build the project. 
hugo -t hyde-x

# Add changes to git.
git add --all
git diff --staged --stat

while true; do
    read -p &amp;quot;Do you wish to push these changes? &amp;quot; yn
    case $yn in
        [Yy]* ) push_git; break;;
        [Nn]* ) exit;;
        * ) echo &amp;quot;Please answer yes or no.&amp;quot;;;
    esac
done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The script:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Builds the current state of the site using &lt;code&gt;hugo&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Adds all the changes to the git index and stages them.&lt;/li&gt;
&lt;li&gt;Gives you a brief overview of what they actually are.&lt;/li&gt;
&lt;li&gt;Asks you to accept these changes.&lt;/li&gt;
&lt;li&gt;Commits the changes, either using a provided messages (i.e. &lt;code&gt;./deploy.sh &amp;quot;your message here&amp;quot;&lt;/code&gt;) or a timestamped default.&lt;/li&gt;
&lt;li&gt;Pushes the changes to the main repository, also holding the &lt;code&gt;hugo&lt;/code&gt; codebase.&lt;/li&gt;
&lt;li&gt;Pushes just the content in &lt;code&gt;public/&lt;/code&gt; to a separate repository, using the &lt;code&gt;master&lt;/code&gt; branch, so that it gets picked up by GitHub Pages.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;That&amp;rsquo;s it. Your changes are now online.&lt;/p&gt;

&lt;h2 id=&#34;troubleshooting:536c0d2c3e7d958cd4c405a28a07ba8a&#34;&gt;Troubleshooting&lt;/h2&gt;

&lt;p&gt;If you see a go backtrace at any point in time and you don&amp;rsquo;t happen to have any content in your blog yet it could be you&amp;rsquo;ve chosen a theme that relies on content to build certain parts of the site i.e. certain variables and/or content snippets. You should be fine once you&amp;rsquo;ve created more than or equal to one post/page.&lt;/p&gt;

&lt;h2 id=&#34;further-reading:536c0d2c3e7d958cd4c405a28a07ba8a&#34;&gt;Further reading&lt;/h2&gt;

&lt;p&gt;Hugo is very well documented, literally anything you desire can either by found &lt;a href=&#34;http://gohugo.io/overview/introduction/&#34;&gt;in the docs&lt;/a&gt; or on &lt;a href=&#34;http://discuss.gohugo.io/&#34;&gt;their buzzing forums&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;conclusion:536c0d2c3e7d958cd4c405a28a07ba8a&#34;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;I couldn&amp;rsquo;t be happier with the setup at the moment. Right now, creating new posts is just about running &lt;code&gt;hugo new post/&amp;lt;post&amp;gt;.md&lt;/code&gt;, adding my content and then &lt;code&gt;./deploy.sh&lt;/code&gt;. After that it&amp;rsquo;s online. Two simple steps.&lt;/p&gt;

&lt;p&gt;It&amp;rsquo;s much easier and more seamless as it was before. I&amp;rsquo;m sorry to be moving away from such an accomplished project as Jekyll, but maintaining Jekyll and it&amp;rsquo;s dependencies just isn&amp;rsquo;t what I&amp;rsquo;m after and &lt;a href=&#34;http://www.octopress.org&#34;&gt;Octopress 3.0&lt;/a&gt; isn&amp;rsquo;t ready yet.&lt;/p&gt;

&lt;p&gt;For the time being, here&amp;rsquo;s to a bright future using &lt;a href=&#34;http://gohugo.io&#34;&gt;Hugo&lt;/a&gt;!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>About me</title>
      <link>http://heiber.im/about/</link>
      <pubDate>Sun, 10 May 2015 11:35:02 +0200</pubDate>
      <author>hello@heiber.im (Moritz Heiber)</author>
      <guid>http://heiber.im/about/</guid>
      <description>

&lt;p&gt;
&lt;figure class=&#34;about&#34;&gt;
    
        &lt;img src=&#34;http://heiber.im/images/moritz2.jpg&#34; /&gt;
    
    
    &lt;figcaption&gt;
        &lt;h4&gt;Copyright 2015, Martin Fowler&lt;/h4&gt;
        
    &lt;/figcaption&gt;
    
&lt;/figure&gt;

I&amp;rsquo;m Moritz Heiber and I work as DevOps Birth Assistant at &lt;a href=&#34;https://www.thoughtworks.com&#34;&gt;ThoughtWorks&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I used to work at ZenGuard as their VP of Engineering and at &lt;a href=&#34;http://www.babbel.com&#34;&gt;Babbel&lt;/a&gt; as their DevOps &amp;amp; Infrastructure Lead.&lt;/p&gt;

&lt;p&gt;I also work as an independent consultant on all things computers and Internet.&lt;/p&gt;

&lt;p&gt;I love &lt;a href=&#34;http://www.ruby-lang.org&#34;&gt;Ruby&lt;/a&gt;, &lt;a href=&#34;http://www.rust-lang.org&#34;&gt;Rust&lt;/a&gt;, &lt;a href=&#34;https://golang.org&#34;&gt;Go&lt;/a&gt;, &lt;a href=&#34;http://linux.org&#34;&gt;Linux&lt;/a&gt; and all the things that come with them. I usually wrap my head around politics as well and I&amp;rsquo;m actively involved in promoting open source, diversity and the spirit behind them.&lt;/p&gt;

&lt;p&gt;I like to give talks on DevOps, system operations and shiny things:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/moritzheiber/i-dont-care-for-what-you-did-last-summer&#34;&gt;I don&amp;rsquo;t care what you did last summer - Continuous Delivery and Immutable Servers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/moritzheiber/codetalks-2014-fluentd-presentation&#34;&gt;Log the things! (German)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;stuff-i-use:6083a88ee3411b0d17ce02d738f69d47&#34;&gt;Stuff I use&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.i3wm.org&#34;&gt;i3wm&lt;/a&gt;: Exceptionally simple and versatile &lt;a href=&#34;http://en.wikipedia.org/wiki/Tiling_window_manager&#34;&gt;tiling window manager&lt;/a&gt;. Beware: Once you use it every other way of interacting with a graphical user interfaces will seem inferior.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://vim.org&#34;&gt;vim&lt;/a&gt;: &lt;em&gt;The&lt;/em&gt; texteditor for pretty much anything. I might put up my &lt;code&gt;vimrc&lt;/code&gt; at some point in time.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/swanson/stringer&#34;&gt;stringer&lt;/a&gt;: Extremely easy to set up (literally takes you 10 minutes to get it running with Heroku. At no cost.) Rails rss feed aggregator. Has a beautiful web interface and implements the &lt;a href=&#34;http://feedafever.com&#34;&gt;Fever&lt;/a&gt; API specifications (for using &lt;a href=&#34;http://reederapp.com&#34;&gt;Reeder&lt;/a&gt; or &lt;a href=&#34;http://twentyfivesquares.com/press/&#34;&gt;Press&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Dynamics DNS with pfSense and Route53</title>
      <link>http://heiber.im/post/dynamics-dns-with-pfsense-and-route53/</link>
      <pubDate>Fri, 28 Feb 2014 12:17:36 +0100</pubDate>
      <author>hello@heiber.im (Moritz Heiber)</author>
      <guid>http://heiber.im/post/dynamics-dns-with-pfsense-and-route53/</guid>
      <description>&lt;p&gt;The quite excellent &lt;a href=&#34;https://pfsense.org&#34;&gt;pfSense&lt;/a&gt; comes with a &lt;a href=&#34;http://en.wikipedia.org/wiki/Dynamic_DNS&#34;&gt;dynamic DNS&lt;/a&gt; plugin for &lt;a href=&#34;http://aws.amazon.com/route53/&#34;&gt;Amazon&amp;rsquo;s Route53 DNS management service&lt;/a&gt;. However, there is little to no documentation provided on how to set it up properly and especially about setting up the &lt;a href=&#34;http://aws.amazon.com/iam/&#34;&gt;relevant IAM access policies&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So I went to the &lt;a href=&#34;https://github.com/pfsense/&#34;&gt;pfSense repository on GitHub&lt;/a&gt; and browsed the code in order to find out how much access the plugin needed in order to do its deed.&lt;/p&gt;

&lt;p&gt;As it turns out: not much. The following IAM policy will grant the plugin the required permissions to access Route53 on your behalf:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;Statement&amp;quot;:[
    {
      &amp;quot;Effect&amp;quot;:&amp;quot;Allow&amp;quot;,
      &amp;quot;Action&amp;quot;:[
        &amp;quot;route53:ChangeResourceRecordSets&amp;quot;,
        &amp;quot;route53:ListResourceRecordSets&amp;quot;
      ],
     &amp;quot;Resource&amp;quot;:&amp;quot;arn:aws:route53:::hostedzone/&amp;lt;your-hosted-zone-id&amp;gt;&amp;quot;
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Notice the &lt;code&gt;&amp;lt;your-hosted-zone-id&amp;gt;&lt;/code&gt; which you need to exchange for the ID your zone has been assigned to within Route53.&lt;/p&gt;

&lt;p&gt;What the dynamics DNS module within pfSense actually does:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Connect to the AWS API and look up all the records within the zone you configured&lt;/li&gt;
&lt;li&gt;Determines whether there is a record by the name you entered

&lt;ul&gt;
&lt;li&gt;If there is it deletes the record and adds it back with the new IP address attached to it.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Note: This is also why it is very wise to chose a very low (&amp;lt;= 60 seconds) TTL for your dynamic DNS record&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;If there isn&amp;rsquo;t it creates a new record and attaches the IP address to it&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Saves the IP address it just set within Route53 to a file within the pfSense environment to make sure it doesn&amp;rsquo;t update the same record twice

&lt;ul&gt;
&lt;li&gt;The IP either gets updated when the locally recorded IP address doesn&amp;rsquo;t match the record on Route53 or every 25 days&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;After that the A record should get updated automatically each time the IP changes on the associated interface.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>